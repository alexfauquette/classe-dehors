{"ast":null,"code":"import _regeneratorRuntime from\"/home/alexandre/dev/classe-dehors/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/home/alexandre/dev/classe-dehors/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/home/alexandre/dev/classe-dehors/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectWithoutProperties from\"/home/alexandre/dev/classe-dehors/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import React from'react';import{Button,useNotify,required}from'react-admin';import{Dialog,DialogTitle,DialogContent,DialogActions,makeStyles,TextField}from'@material-ui/core';import{Form,Field}from'react-final-form';import SendIcon from'@material-ui/icons/Send';var useStyles=makeStyles(function(){return{title:{paddingBottom:8},actions:{padding:15},addForm:{paddingTop:0},listForm:{paddingTop:0,paddingBottom:0,paddingRight:0,maxHeight:210}};});var FinalFormTextField=function FinalFormTextField(_ref){var _ref$input=_ref.input,name=_ref$input.name,onChange=_ref$input.onChange,value=_ref$input.value,restInput=_objectWithoutProperties(_ref$input,[\"name\",\"onChange\",\"value\"]),meta=_ref.meta,rest=_objectWithoutProperties(_ref,[\"input\",\"meta\"]);return/*#__PURE__*/React.createElement(TextField,Object.assign({},rest,{name:name,helperText:meta.touched?meta.error:undefined,error:meta.error&&meta.touched,inputProps:restInput,onChange:onChange,value:value}));};var ContactDialog=function ContactDialog(_ref2){var user=_ref2.user,emailPredicate=_ref2.emailPredicate,open=_ref2.open,onClose=_ref2.onClose;var classes=useStyles();var notify=useNotify();var onSubmit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values){var result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetch(process.env.REACT_APP_MIDDLEWARE_URL+'_mailer/contact-user',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(_objectSpread({userUri:user['@id']||user.id,emailPredicate:emailPredicate},values))});case 2:result=_context.sent;if(result.ok){onClose();notify('Votre message a bien été envoyé','success');}else{notify('Erreur lors de votre envoi de message','error');}case 4:case\"end\":return _context.stop();}}},_callee);}));return function onSubmit(_x){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(Form,{onSubmit:onSubmit,render:function render(_ref4){var handleSubmit=_ref4.handleSubmit,form=_ref4.form,submitting=_ref4.submitting,pristine=_ref4.pristine;return/*#__PURE__*/React.createElement(\"form\",{onSubmit:handleSubmit},/*#__PURE__*/React.createElement(Dialog,{fullWidth:true,open:open,onClose:onClose},/*#__PURE__*/React.createElement(DialogTitle,{className:classes.title},\"Contacter \",user['pair:label']),/*#__PURE__*/React.createElement(DialogContent,{className:classes.addForm},/*#__PURE__*/React.createElement(Field,{name:\"name\",component:FinalFormTextField,label:\"Votre nom\",variant:\"filled\",margin:\"dense\",fullWidth:true,validate:required('Champ requis')}),/*#__PURE__*/React.createElement(Field,{name:\"email\",component:FinalFormTextField,label:\"Votre adresse mail\",variant:\"filled\",margin:\"dense\",fullWidth:true,validate:required('Champ requis')}),/*#__PURE__*/React.createElement(Field,{name:\"title\",component:FinalFormTextField,label:\"Objet\",variant:\"filled\",margin:\"dense\",fullWidth:true,validate:required('Champ requis')}),/*#__PURE__*/React.createElement(Field,{name:\"content\",component:FinalFormTextField,label:\"Message\",variant:\"filled\",margin:\"dense\",fullWidth:true,multiline:true,rows:7,validate:required('Champ requis')})),/*#__PURE__*/React.createElement(DialogActions,{className:classes.actions},/*#__PURE__*/React.createElement(Button,{label:\"ra.action.close\",variant:\"text\",onClick:onClose}),/*#__PURE__*/React.createElement(Button,{type:\"submit\",label:\"Envoyer\",variant:\"contained\",endIcon:/*#__PURE__*/React.createElement(SendIcon,null),onClick:function onClick(){return form.submit();},disabled:submitting||pristine}))));}});};export default ContactDialog;","map":{"version":3,"sources":["/home/alexandre/dev/classe-dehors/frontend/src/contact/ContactDialog.js"],"names":["React","Button","useNotify","required","Dialog","DialogTitle","DialogContent","DialogActions","makeStyles","TextField","Form","Field","SendIcon","useStyles","title","paddingBottom","actions","padding","addForm","paddingTop","listForm","paddingRight","maxHeight","FinalFormTextField","input","name","onChange","value","restInput","meta","rest","touched","error","undefined","ContactDialog","user","emailPredicate","open","onClose","classes","notify","onSubmit","values","fetch","process","env","REACT_APP_MIDDLEWARE_URL","method","headers","body","JSON","stringify","userUri","id","result","ok","handleSubmit","form","submitting","pristine","submit"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Button, useNotify, required } from 'react-admin';\nimport { Dialog, DialogTitle, DialogContent, DialogActions, makeStyles, TextField } from '@material-ui/core';\nimport { Form, Field } from 'react-final-form';\nimport SendIcon from '@material-ui/icons/Send';\n\nconst useStyles = makeStyles(() => ({\n  title: {\n    paddingBottom: 8\n  },\n  actions: {\n    padding: 15\n  },\n  addForm: {\n    paddingTop: 0\n  },\n  listForm: {\n    paddingTop: 0,\n    paddingBottom: 0,\n    paddingRight: 0,\n    maxHeight: 210\n  }\n}));\n\nconst FinalFormTextField = ({ input: { name, onChange, value, ...restInput }, meta, ...rest }) => (\n  <TextField\n    {...rest}\n    name={name}\n    helperText={meta.touched ? meta.error : undefined}\n    error={meta.error && meta.touched}\n    inputProps={restInput}\n    onChange={onChange}\n    value={value}\n  />\n);\n\nconst ContactDialog = ({ user, emailPredicate, open, onClose }) => {\n  const classes = useStyles();\n  const notify = useNotify();\n\n  const onSubmit = async values => {\n    const result = await fetch(process.env.REACT_APP_MIDDLEWARE_URL + '_mailer/contact-user', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ userUri: user['@id'] || user.id, emailPredicate, ...values })\n    });\n\n    if( result.ok ) {\n      onClose();\n      notify('Votre message a bien été envoyé', 'success');\n    } else {\n      notify('Erreur lors de votre envoi de message', 'error');\n    }\n  };\n\n  return (\n    <Form\n      onSubmit={onSubmit}\n      render={({ handleSubmit, form, submitting, pristine }) => (\n        <form onSubmit={handleSubmit}>\n          <Dialog fullWidth open={open} onClose={onClose}>\n            <DialogTitle className={classes.title}>Contacter {user['pair:label']}</DialogTitle>\n            <DialogContent className={classes.addForm}>\n              <Field name=\"name\" component={FinalFormTextField} label=\"Votre nom\" variant=\"filled\" margin=\"dense\" fullWidth validate={required('Champ requis')} />\n              <Field name=\"email\" component={FinalFormTextField} label=\"Votre adresse mail\" variant=\"filled\" margin=\"dense\" fullWidth validate={required('Champ requis')} />\n              <Field name=\"title\" component={FinalFormTextField} label=\"Objet\" variant=\"filled\" margin=\"dense\" fullWidth validate={required('Champ requis')} />\n              <Field name=\"content\" component={FinalFormTextField} label=\"Message\" variant=\"filled\" margin=\"dense\" fullWidth multiline rows={7} validate={required('Champ requis')} />\n            </DialogContent>\n            <DialogActions className={classes.actions}>\n              <Button label=\"ra.action.close\" variant=\"text\" onClick={onClose} />\n              <Button type=\"submit\" label=\"Envoyer\" variant=\"contained\" endIcon={<SendIcon />} onClick={() => form.submit()} disabled={submitting || pristine} />\n            </DialogActions>\n          </Dialog>\n        </form>\n      )}\n    />\n  );\n};\n\nexport default ContactDialog;\n"]},"metadata":{},"sourceType":"module"}