{"ast":null,"code":"var _jsxFileName = \"/home/alexandre/dev/classe-dehors/frontend/src/pair/ReferenceQuickCreateInput.js\";\nimport React, { useState } from \"react\";\nimport { useForm } from \"react-final-form\";\nimport { Button, SaveButton, useCreate, useNotify, useTranslate, FormWithRedirect, SelectInput } from \"react-admin\";\nimport { Dialog, DialogTitle, DialogContent, DialogActions, makeStyles } from \"@material-ui/core\";\nimport IconContentAdd from \"@material-ui/icons/Add\";\nimport IconCancel from \"@material-ui/icons/Cancel\";\nimport { ReferenceInput } from \"@semapps/semantic-data-provider\";\nconst useStyles = makeStyles({\n  root: {\n    display: \"flex\",\n    alignItems: \"center\"\n  },\n  dialogTitle: {\n    paddingBottom: 0\n  }\n});\n\nconst ReferenceQuickCreateInput = ({\n  children,\n  selectOptionText,\n  ...rest\n}) => {\n  const classes = useStyles();\n  const [showDialog, setShowDialog] = useState(false);\n  const [version, setVersion] = useState(0);\n  const [create, {\n    loading\n  }] = useCreate(rest.reference);\n  const notify = useNotify();\n  const translate = useTranslate();\n  const form = useForm();\n\n  const handleSubmit = requiredFields => async values => {\n    const missingInputs = requiredFields.filter(source => values[source] === undefined || values[source] === null);\n\n    if (missingInputs.length > 0) {\n      notify(\"Vous avez oublié des champs\", \"error\");\n    } else {\n      create({\n        payload: {\n          data: values\n        }\n      }, {\n        onSuccess: ({\n          data\n        }) => {\n          setShowDialog(false); // Update the comment form to target the newly created post\n\n          form.change(rest.source, data.id); // Increase the version so that ReferenceInput reload all the available values\n\n          setVersion(version + 1);\n        },\n        onFailure: ({\n          error\n        }) => {\n          notify(error.message, \"error\");\n        }\n      });\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.root,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(ReferenceInput, Object.assign({\n    key: version\n  }, rest, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(SelectInput, {\n    optionText: selectOptionText,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(Button, {\n    onClick: () => setShowDialog(true),\n    label: \"ra.action.create\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(IconContentAdd, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(Dialog, {\n    fullWidth: true,\n    open: showDialog,\n    onClose: () => setShowDialog(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(DialogTitle, {\n    className: classes.dialogTitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 9\n    }\n  }, translate(\"ra.action.create\")), /*#__PURE__*/React.createElement(FormWithRedirect, {\n    resource: rest.reference,\n    save: handleSubmit,\n    render: ({\n      handleSubmitWithRedirect,\n      pristine,\n      saving\n    }) => /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(DialogContent, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 15\n      }\n    }, children), /*#__PURE__*/React.createElement(DialogActions, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      label: \"ra.action.cancel\",\n      onClick: () => setShowDialog(false),\n      disabled: loading,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(IconCancel, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 19\n      }\n    })), /*#__PURE__*/React.createElement(SaveButton, {\n      handleSubmitWithRedirect: handleSubmitWithRedirect,\n      pristine: pristine,\n      saving: saving,\n      disabled: loading,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 17\n      }\n    }))),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 9\n    }\n  })));\n};\n\nexport default ReferenceQuickCreateInput;","map":{"version":3,"sources":["/home/alexandre/dev/classe-dehors/frontend/src/pair/ReferenceQuickCreateInput.js"],"names":["React","useState","useForm","Button","SaveButton","useCreate","useNotify","useTranslate","FormWithRedirect","SelectInput","Dialog","DialogTitle","DialogContent","DialogActions","makeStyles","IconContentAdd","IconCancel","ReferenceInput","useStyles","root","display","alignItems","dialogTitle","paddingBottom","ReferenceQuickCreateInput","children","selectOptionText","rest","classes","showDialog","setShowDialog","version","setVersion","create","loading","reference","notify","translate","form","handleSubmit","requiredFields","values","missingInputs","filter","source","undefined","length","payload","data","onSuccess","change","id","onFailure","error","message","handleSubmitWithRedirect","pristine","saving"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport { useForm } from \"react-final-form\";\nimport {\n  Button,\n  SaveButton,\n  useCreate,\n  useNotify,\n  useTranslate,\n  FormWithRedirect,\n  SelectInput,\n} from \"react-admin\";\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  makeStyles,\n} from \"@material-ui/core\";\nimport IconContentAdd from \"@material-ui/icons/Add\";\nimport IconCancel from \"@material-ui/icons/Cancel\";\nimport { ReferenceInput } from \"@semapps/semantic-data-provider\";\n\nconst useStyles = makeStyles({\n  root: {\n    display: \"flex\",\n    alignItems: \"center\",\n  },\n  dialogTitle: {\n    paddingBottom: 0,\n  },\n});\n\nconst ReferenceQuickCreateInput = ({ children, selectOptionText, ...rest }) => {\n  const classes = useStyles();\n\n  const [showDialog, setShowDialog] = useState(false);\n  const [version, setVersion] = useState(0);\n  const [create, { loading }] = useCreate(rest.reference);\n  const notify = useNotify();\n  const translate = useTranslate();\n  const form = useForm();\n\n  const handleSubmit = (requiredFields) => async (values) => {\n    const missingInputs = requiredFields.filter(\n      (source) => values[source] === undefined || values[source] === null\n    );\n    if (missingInputs.length > 0) {\n      notify(\"Vous avez oublié des champs\", \"error\");\n    } else {\n      create(\n        { payload: { data: values } },\n        {\n          onSuccess: ({ data }) => {\n            setShowDialog(false);\n            // Update the comment form to target the newly created post\n            form.change(rest.source, data.id);\n            // Increase the version so that ReferenceInput reload all the available values\n            setVersion(version + 1);\n          },\n          onFailure: ({ error }) => {\n            notify(error.message, \"error\");\n          },\n        }\n      );\n    }\n  };\n\n  return (\n    <div className={classes.root}>\n      {/* Updating the key will force ReferenceInput to reload the available values */}\n      <ReferenceInput key={version} {...rest}>\n        <SelectInput optionText={selectOptionText} />\n      </ReferenceInput>\n      <Button onClick={() => setShowDialog(true)} label=\"ra.action.create\">\n        <IconContentAdd />\n      </Button>\n      <Dialog fullWidth open={showDialog} onClose={() => setShowDialog(false)}>\n        <DialogTitle className={classes.dialogTitle}>\n          {translate(\"ra.action.create\")}\n        </DialogTitle>\n        <FormWithRedirect\n          resource={rest.reference}\n          save={handleSubmit}\n          render={({ handleSubmitWithRedirect, pristine, saving }) => (\n            <>\n              <DialogContent>{children}</DialogContent>\n              <DialogActions>\n                <Button\n                  label=\"ra.action.cancel\"\n                  onClick={() => setShowDialog(false)}\n                  disabled={loading}\n                >\n                  <IconCancel />\n                </Button>\n                <SaveButton\n                  handleSubmitWithRedirect={handleSubmitWithRedirect}\n                  pristine={pristine}\n                  saving={saving}\n                  disabled={loading}\n                />\n              </DialogActions>\n            </>\n          )}\n        />\n      </Dialog>\n    </div>\n  );\n};\n\nexport default ReferenceQuickCreateInput;\n"]},"metadata":{},"sourceType":"module"}