{"ast":null,"code":"import _regeneratorRuntime from\"/home/alexandre/dev/classe-dehors/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/alexandre/dev/classe-dehors/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/alexandre/dev/classe-dehors/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectWithoutProperties from\"/home/alexandre/dev/classe-dehors/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import React,{useState}from\"react\";import{useForm}from\"react-final-form\";import{Button,SaveButton,useCreate,useNotify,useTranslate,FormWithRedirect,SelectInput}from\"react-admin\";import{Dialog,DialogTitle,DialogContent,DialogActions,makeStyles}from\"@material-ui/core\";import IconContentAdd from\"@material-ui/icons/Add\";import IconCancel from\"@material-ui/icons/Cancel\";import{ReferenceInput}from\"@semapps/semantic-data-provider\";var useStyles=makeStyles({root:{display:\"flex\",alignItems:\"center\"},dialogTitle:{paddingBottom:0}});var ReferenceQuickCreateInput=function ReferenceQuickCreateInput(_ref){var children=_ref.children,selectOptionText=_ref.selectOptionText,helperText=_ref.helperText,rest=_objectWithoutProperties(_ref,[\"children\",\"selectOptionText\",\"helperText\"]);var classes=useStyles();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),showDialog=_useState2[0],setShowDialog=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),version=_useState4[0],setVersion=_useState4[1];var _useCreate=useCreate(rest.reference),_useCreate2=_slicedToArray(_useCreate,2),create=_useCreate2[0],loading=_useCreate2[1].loading;var notify=useNotify();var translate=useTranslate();var form=useForm();var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:create({payload:{data:values}},{onSuccess:function onSuccess(_ref3){var data=_ref3.data;setShowDialog(false);// Update the comment form to target the newly created post\nform.change(rest.source,data.id);// Increase the version so that ReferenceInput reload all the available values\nsetVersion(version+1);},onFailure:function onFailure(_ref4){var error=_ref4.error;notify(error.message,\"error\");}});case 1:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(\"div\",{className:classes.root},/*#__PURE__*/React.createElement(ReferenceInput,Object.assign({key:version},rest),/*#__PURE__*/React.createElement(SelectInput,{optionText:selectOptionText,helperText:helperText})),/*#__PURE__*/React.createElement(Button,{onClick:function onClick(){return setShowDialog(true);},label:\"ra.action.create\"},/*#__PURE__*/React.createElement(IconContentAdd,null)),/*#__PURE__*/React.createElement(Dialog,{fullWidth:true,open:showDialog,onClose:function onClose(){return setShowDialog(false);}},/*#__PURE__*/React.createElement(DialogTitle,{className:classes.dialogTitle},translate(\"ra.action.create\")),/*#__PURE__*/React.createElement(FormWithRedirect,{resource:rest.reference,save:handleSubmit,render:function render(_ref5){var handleSubmitWithRedirect=_ref5.handleSubmitWithRedirect,pristine=_ref5.pristine,saving=_ref5.saving;return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(DialogContent,null,children),/*#__PURE__*/React.createElement(DialogActions,null,/*#__PURE__*/React.createElement(Button,{label:\"ra.action.cancel\",onClick:function onClick(){return setShowDialog(false);},disabled:loading},/*#__PURE__*/React.createElement(IconCancel,null)),/*#__PURE__*/React.createElement(SaveButton,{handleSubmitWithRedirect:handleSubmitWithRedirect,pristine:pristine,saving:saving,disabled:loading})));}})));};export default ReferenceQuickCreateInput;","map":{"version":3,"sources":["/home/alexandre/dev/classe-dehors/frontend/src/pair/ReferenceQuickCreateInput.js"],"names":["React","useState","useForm","Button","SaveButton","useCreate","useNotify","useTranslate","FormWithRedirect","SelectInput","Dialog","DialogTitle","DialogContent","DialogActions","makeStyles","IconContentAdd","IconCancel","ReferenceInput","useStyles","root","display","alignItems","dialogTitle","paddingBottom","ReferenceQuickCreateInput","children","selectOptionText","helperText","rest","classes","showDialog","setShowDialog","version","setVersion","reference","create","loading","notify","translate","form","handleSubmit","values","payload","data","onSuccess","change","source","id","onFailure","error","message","handleSubmitWithRedirect","pristine","saving"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport { useForm } from \"react-final-form\";\nimport {\n  Button,\n  SaveButton,\n  useCreate,\n  useNotify,\n  useTranslate,\n  FormWithRedirect,\n  SelectInput,\n} from \"react-admin\";\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  makeStyles,\n} from \"@material-ui/core\";\nimport IconContentAdd from \"@material-ui/icons/Add\";\nimport IconCancel from \"@material-ui/icons/Cancel\";\nimport { ReferenceInput } from \"@semapps/semantic-data-provider\";\n\nconst useStyles = makeStyles({\n  root: {\n    display: \"flex\",\n    alignItems: \"center\",\n  },\n  dialogTitle: {\n    paddingBottom: 0,\n  },\n});\n\nconst ReferenceQuickCreateInput = ({\n  children,\n  selectOptionText,\n  helperText,\n  ...rest\n}) => {\n  const classes = useStyles();\n\n  const [showDialog, setShowDialog] = useState(false);\n  const [version, setVersion] = useState(0);\n  const [create, { loading }] = useCreate(rest.reference);\n  const notify = useNotify();\n  const translate = useTranslate();\n  const form = useForm();\n\n  const handleSubmit = async (values) => {\n    create(\n      { payload: { data: values } },\n      {\n        onSuccess: ({ data }) => {\n          setShowDialog(false);\n          // Update the comment form to target the newly created post\n          form.change(rest.source, data.id);\n          // Increase the version so that ReferenceInput reload all the available values\n          setVersion(version + 1);\n        },\n        onFailure: ({ error }) => {\n          notify(error.message, \"error\");\n        },\n      }\n    );\n  };\n\n  return (\n    <div className={classes.root}>\n      {/* Updating the key will force ReferenceInput to reload the available values */}\n      <ReferenceInput key={version} {...rest}>\n        <SelectInput optionText={selectOptionText} helperText={helperText} />\n      </ReferenceInput>\n      <Button onClick={() => setShowDialog(true)} label=\"ra.action.create\">\n        <IconContentAdd />\n      </Button>\n      <Dialog fullWidth open={showDialog} onClose={() => setShowDialog(false)}>\n        <DialogTitle className={classes.dialogTitle}>\n          {translate(\"ra.action.create\")}\n        </DialogTitle>\n        <FormWithRedirect\n          resource={rest.reference}\n          save={handleSubmit}\n          render={({ handleSubmitWithRedirect, pristine, saving }) => (\n            <>\n              <DialogContent>{children}</DialogContent>\n              <DialogActions>\n                <Button\n                  label=\"ra.action.cancel\"\n                  onClick={() => setShowDialog(false)}\n                  disabled={loading}\n                >\n                  <IconCancel />\n                </Button>\n                <SaveButton\n                  handleSubmitWithRedirect={handleSubmitWithRedirect}\n                  pristine={pristine}\n                  saving={saving}\n                  disabled={loading}\n                />\n              </DialogActions>\n            </>\n          )}\n        />\n      </Dialog>\n    </div>\n  );\n};\n\nexport default ReferenceQuickCreateInput;\n"]},"metadata":{},"sourceType":"module"}